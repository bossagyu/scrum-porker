# スクラムポーカー - 統合設計ドキュメント

作成日: 2026-02-08
ステータス: レビュー待ち

---

## 1. プロダクト概要

**プロダクト名:** Scrum Poker（仮）
**概要:** アカウント不要で即座に利用できる、シンプルで美しいスクラムポーカーWebアプリケーション
**ターゲット:** アジャイル開発チーム（5〜20名規模）

**コアバリュー:**
- URL共有だけで即参加（登録不要）
- アンカリングバイアスを防止する厳密な同時公開
- レスポンシブでモバイルにも対応

---

## 2. 技術スタック（確定）

```yaml
フロントエンド:
  フレームワーク: Next.js 15 (App Router)
  言語: TypeScript 5.x
  UIライブラリ: React 19
  スタイリング: Tailwind CSS 4.x
  UIコンポーネント: shadcn/ui
  状態管理: Zustand
  フォーム: React Hook Form + Zod

バックエンド:
  BaaS: Supabase
  API: Next.js Server Actions + API Routes
  データベース: PostgreSQL (Supabase)
  リアルタイム: Supabase Realtime (WebSocket)

認証:
  方式: ゲスト参加（匿名認証）
  将来: Google/GitHub OAuth（オプション）

ホスティング:
  フロントエンド: Vercel
  バックエンド/DB: Supabase Cloud

開発ツール:
  パッケージマネージャー: pnpm
  リンター: ESLint + Prettier
  テスト: Vitest (Unit) + Playwright (E2E)
  CI/CD: GitHub Actions + Vercel Auto Deploy
```

**選定理由:**
- 無料枠で運用開始可能（$0/月〜）
- Supabaseでバックエンドコード最小化 → 開発速度最大化
- Next.js + Vercelで最高のDXとパフォーマンス
- TypeScript + Zod で型安全なコード

---

## 3. 機能要件（MoSCoW）

### Must（v1必須）
| 機能 | 詳細 |
|------|------|
| ルーム作成 | ルーム名設定、一意のコード自動生成、参加用URL発行 |
| URL参加 | アカウント不要、表示名入力のみ |
| カード投票 | フィボナッチ数列（0,1,2,3,5,8,13,21,34,?,∞,☕） |
| 投票状態表示 | リアルタイムで未投票/投票済みを表示 |
| 一斉公開 | ファシリテーターによる手動公開、または全員投票完了時の自動公開 |
| 結果サマリー | 平均値・中央値・最頻値・分布表示 |
| 自動公開設定 | 全員投票完了時に結果を自動公開するオプション（デフォルト有効） |
| 複数ラウンド | リセットして連続投票、投票前の変更可能 |

### Should（v1推奨）
| 機能 | 詳細 |
|------|------|
| カードセット選択 | フィボナッチ、Tシャツサイズ、2のべき乗 |
| タイマー | 30秒/1分/2分/5分、カウントダウン表示 |
| 投票履歴 | ラウンド別結果一覧、CSV/JSONエクスポート |
| ファシリテーター管理 | 権限移譲、参加者退室機能 |

### Could（将来）
- Jira/GitHub Issues連携
- ダークモード
- 絵文字リアクション
- 見積もり精度分析
- 非同期投票

### Won't（v1対象外）
- ネイティブモバイルアプリ
- チャット機能
- ユーザーアカウント管理
- 有料プラン

---

## 4. 主要画面構成

| # | 画面 | 概要 |
|---|------|------|
| 1 | トップ/ルーム作成 | ルーム名・カードセット・タイマー設定 → 作成 |
| 2 | URL共有画面 | 参加用URLのコピー、ルーム設定の確認 |
| 3 | 投票画面 | 参加者一覧、カード選択、投票状態リアルタイム表示 |
| 4 | 結果表示画面 | サマリー、参加者別結果、分布グラフ |
| 5 | 設定画面 | カードセット変更、タイマー、ファシリテーター移譲 |
| 6 | 履歴画面 | ラウンド別結果一覧、エクスポート |

※ 詳細なワイヤーフレームは `requirements-and-screens.md` を参照

---

## 5. データベース設計

### テーブル構成

```
rooms (ルーム)
  ├── participants (参加者)
  ├── voting_sessions (投票セッション)
  │     └── votes (投票)
  └── session_history (セッション履歴)
```

### 主要テーブル

- **rooms**: ルーム情報（コード、名前、カードセット、有効期限24h）
- **participants**: 参加者（表示名、オブザーバーフラグ）
- **voting_sessions**: 投票ラウンド（トピック、公開フラグ）
- **votes**: 個別投票（カード値、タイムスタンプ）
- **session_history**: 確定結果のスナップショット

※ 詳細なSQL定義は `architecture-design.md` を参照

---

## 6. 非機能要件

| カテゴリ | 要件 |
|---------|------|
| パフォーマンス | ページ表示 < 2秒、リアルタイム同期 < 500ms |
| 同時接続 | 1ルーム5-20名、初期100ルーム同時稼働 |
| セキュリティ | HTTPS/WSS、XSS/CSRF対策、Rate Limiting |
| アクセシビリティ | WCAG 2.1 AA準拠、キーボード操作対応 |
| レスポンシブ | Mobile/Tablet/Desktop 3ブレークポイント |
| データ保持 | 72時間後に自動削除 |
| 対応ブラウザ | Chrome/Firefox/Safari/Edge 最新+1バージョン |
| 言語 | 日本語（デフォルト）、英語 |

---

## 7. コスト見積もり

| フェーズ | 月額コスト | 想定ユーザー |
|---------|-----------|------------|
| 個人開発・ローンチ | $0〜$1 | 〜1,000 MAU |
| 成長期 | $45 | 〜10,000 MAU |
| スケール期 | $695〜$745 | 〜100,000 MAU |

---

## 8. 実装フェーズ

### Phase 1: MVP
- Next.js + Supabase プロジェクト初期化
- DB設計・マイグレーション
- ルーム作成・参加機能（ゲスト認証）
- 基本投票機能（カード選択・リアルタイム同期・一斉公開）
- Vercelデプロイ

### Phase 2: 機能拡張
- カードセット選択（3種類）
- タイマー機能
- 投票結果の統計・分布表示
- セッション履歴・エクスポート

### Phase 3: 品質向上
- UI/UXポリッシュ（アニメーション、レスポンシブ最適化）
- エラーハンドリング・ローディング状態
- E2Eテスト
- SEO対策

### Phase 4: 運用準備
- Sentry統合（エラー監視）
- Vercel Analytics
- ドキュメント整備
- 本番環境デプロイ

---

## 9. 競合との差別化

市場調査（`research-existing-services.md` 参照）から特定した差別化ポイント:

1. **厳密な同時公開**: Pointing Poker等の「即時表示」問題を解消
2. **ゼロ登録体験**: URL共有だけで即参加、摩擦最小化
3. **美しいUI/UX**: shadcn/ui + アニメーションで洗練されたデザイン
4. **日本語ファースト**: 日本語をデフォルト言語として最適化
5. **完全無料**: 無料枠で運用可能、広告なし

---

## 10. リスクと対策

| リスク | 影響度 | 対策 |
|--------|-------|------|
| Supabase無料枠超過 | 中 | 使用量監視、アラート、有料プラン移行準備 |
| スパム・悪用 | 高 | Rate Limiting、ルーム自動削除、通報機能 |
| リアルタイム同期遅延 | 中 | 再接続ロジック、楽観的UI更新 |
| セキュリティ脆弱性 | 高 | RLS、入力バリデーション、定期監査 |

---

## 関連ドキュメント

- [既存サービス調査](./research-existing-services.md)
- [技術アーキテクチャ設計](./architecture-design.md)
- [機能要件・画面設計](./requirements-and-screens.md)
